 
---
comment: |
  This can't be the best way to do this. Can a DADict act like a checkboxes dictionary?
code: |
  defense_rent_pleading_requirement
  defense_lease_not_attached
  defense_tender_refused
  defense_rent_payment
  defense_settlement
  defense_lease_signed_under_duress
  defense_fraud_lease
  defense_liquidated_damages_late_fees
  defense_breach_of_cqe
  defense_estoppel_illegality
  defense_breach_of_habitability
  defense_foreclosure
  defense_new_owner_failed_to_provide_notice_of_sale
  defense_unrepresented_corporation
  defense_no_landlord_tenant_relationship
  defense_excessive_rent_for_subsidized_housing
  defense_logic = True
---
depends on:
  - tenant_got_summons
  - petition_available
  - petition_alleges_nonrent
  - petition_states_rent_amount
  - lease_attached
  - petition_states_terms_of_lease
  - petition_states_rent_periods
  - petition_states_demand_made
  - trial_court.circuit
  - petition_separates_nonrent
code: |
  if tenant_got_summons and petition_available:
    if petition_alleges_nonrent or not petition_states_rent_amount or (not lease_attached and not petition_states_terms_of_lease) or not petition_states_rent_periods or not petition_states_demand_made or (trial_court.circuit == 21 and not petition_separates_nonrent):
      defense_rent_pleading_requirement = True
    else:
      defense_rent_pleading_requirement = False
  else:
      defense_rent_pleading_requirement = None
---
depends on:
  - tenant_got_summons
  - petition_available
  - lease_attached
code: |
  if tenant_got_summons and petition_available:
    if not lease_attached:
      defense_lease_not_attached = True
    else:
      defense_lease_not_attached = False
  else:
      defense_lease_not_attached = None
---
question: Is the lease attached to the petition?
fields:
  - Is the lease attached to the complaint?: lease_attached
    datatype: yesnoradio
---
depends on: offer_attempts
code: |
  defense_tender_refused = False
  if offer_attempts.there_are_any:
    for offer in offer_attempts:
      if offer.has_refused_payment and offer.has_attempt_evidence and offer.was_attempt_full:
        defense_tender_refused = True
comment: |
  add date requirement
---
code: |
  if was_rent_paid:
    defense_rent_payment = True
  else:
    defense_rent_payment = False
depends on: was_rent_paid
---
code: |
  if landlord_agreement and tenant_compliance_with_agreement:
    defense_settlement = True
  else:
    defense_settlement = False
depends on:
  - landlord_agreement
  - tenant_compliance_with_agreement
---
id: made settlement
question: |
  % if person_answering == "tenant":
  Did you already make an agreement with your landlord to stop the eviction?
  % else: 
  Did the tenant already make an agreement with their landlord to stop the eviction?
  % endif
subquestion: |
  A landlord and tenant can agree to "settle" an eviction case, which means an agreement to stop the eviction.
fields:
  - label: |
      % if person_answering == "tenant":
      Did you make a settlement agreement with your landlord?
      % else: 
      Did the tenant make a settlement agreement with their landlord?
      % endif
    field: landlord_agreement
    datatype: yesnoradio
  - label: |
      % if person_answering == "tenant":
      Did you follow the terms of the agreement?
      % else: 
      Did the tenant follow the terms of the agreement?:
      % endif
    field: tenant_compliance_with_agreement
    datatype: yesnoradio
    show if: landlord_agreement
---
code: |
  defense_lease_signed_under_duress = unfair_duress
depends on:
  - unfair_duress
---
id: duress
question: |
  % if person_answering == "tenant":
  Did the landlord unfairly make or pressure you to sign the lease?
  % else: 
  Did the landlord unfairly make or pressure the tenant to sign the lease?
  % endif
subquestion: |
  ${ collapse_template(unfair_duress_explanation_template) }
fields:
  - label: |
      % if person_answering == "tenant":
      Did the landlord unfairly make or pressure you to sign the lease?
      % else: 
      Did the landlord unfairly make or pressure the tenant to sign the lease?
      % endif
    field: unfair_duress
    datatype: yesnoradio
---
template: unfair_duress_explanation_template
subject: |
  What counts as "unfair pressure"?
content: |
  Only a judge can decide. But unfair pressure may include:
  
  % if person_answering == "tenant":
  * A threat to hurt you or someone else,
  % else:
  * A threat to hurt the tenant or someone else,
  % endif
  * An **implied** threat to hurt you or someone else, or
  * Extreme psychological pressure.
---
code: |
  if len(false_promises) > 0 and not relied_on_false_promises:
    defense_fraud_lease = True
  else:
    defense_fraud_lease = False
depends on:
  - false_promises
  - relied_on_false_promises
---
objects:
  - false_promises: DAList
---
id: landlord lied
question: |
  % if person_answering == "tenant":
  Did your landlord tell you something that was not true to get you to sign the lease?
  % else:
  Did the landlord tell the tenant something that was not true to get the tenant to sign the lease?
  % endif
subquestion: |
  ${ collapse_template(false_promise_example_template) }
fields:
  - label: |
      % if person_answering == "tenant":
      Did your landlord make any false promises to you before you signed the lease?
      % else: 
      Did the landlord make any false promises to the tenant before the tenant signed the lease?
      % endif
    field: false_promises.there_are_any
    datatype: yesnoradio
  - label: |
      % if person_answering == "tenant":
      What was the **first** false promise your landlord made to you?
      % else: 
      What was the **first** false promise the landlord made to the tenant?
      % endif
    field: false_promises[0]
    show if: false_promises.there_are_any
---
template: false_promise_example_template
subject: |
  What counts as a false promise?
content: |
  % if person_answering == "tenant":
  If your landlord told you something that got you to sign the lease and
  that turned out not to be true, it may be a false promise.

  For example:

  * Promising to paint a room,
  * Promising to replace a carpet, or
  * Promising that an old appliance would get replaced before you moved in.

  Those may count as false promises. What matters is that you would not
  have signed the lease if your landlord had not told you something that
  turned out not to be true.
  % else: 
  If the landlord told the tenant something that got the tenant to sign the 
  lease and that turned out not to be true, it may be a false promise.

  For example:

  * Promising to paint a room,
  * Promising to replace a carpet, or
  * Promising that an old appliance would get replaced before the tenant moved 
  in.

  Those may count as false promises. What matters is that the tenant would not
  have signed the lease if the landlord had not told the tenant something that
  turned out not to be true.
  % endif
---
id: promises i
question: |
  % if person_answering == "tenant":
  What was the **${ ordinal(i) }** false promise your landlord made?
  % else: 
  What was the **${ ordinal(i) }** false promise the landlord made?
  % endif
subquestion: |
  % if person_answering == "tenant":
  You already told us about:
  % else:
  The tenant already told us about:
  % endif

  % for promise in false_promises:
  * ${ promise }
  % endfor
fields:
  - Describe the landlord's false promise: false_promises[i]
---
id: false promises there is another
question: |
  % if person_answering == "tenant":
  Did your landlord promise anything else that was not true?
  % else:  
  Did the landlord promise anything else that was not true?
  % endif
subquestion: |
  % if person_answering == "tenant":
  You already told us about:
  % else:
  The tenant already told us about:
  % endif

  % for promise in false_promises:
  * ${ promise }
  % endfor
fields:
  - label: |
      % if person_answering == "tenant":
      Did your landlord promise anything else that was not true? 
      % else: 
      Did the landlord promise anything else that was not true? 
      % endif
    field: false_promises.there_is_another
    datatype: yesnoradio
---
id: relied on promise
question: |
  % if person_answering == "tenant":
  Did your landlord's promise get you to sign the lease?
  % else: 
  Did the landlord's promise get the tenant to sign the lease?
  % endif
subquestion: |
  % if person_answering == "tenant":
  % if false_promises.number() == 1:
  You told us the landlord made 1 false promise:
  % else:
  You told us the landlord made ${ false_promises.number() } false promises:
  % endif
  % else: 
  % if false_promises.number() == 1:
  The tenant told us the landlord made 1 false promise:
  % else:
  The tenant told us the landlord made ${ false_promises.number() } false 
  promises:
  % endif
  % endif

  % for promise in false_promises:
  * ${ promise }
  % endfor  
fields:
  - label: |
      % if person_answering == "tenant":
      % if false_promises.number() == 1:
      Did your landlord's promise get you to sign the lease?
      % else:
      Did your landlord's promises get you to sign the lease?
      % endif
      % else: 
      % if false_promises.number() == 1:
      Did the landlord's promise get the tenant to sign the lease?
      % else:
      Did the landlord's promises get the tenant to sign the lease?
      % endif
      % endif
    field: relied_on_false_promises
    datatype: yesnoradio
  - note: |
      % if person_answering == "tenant":
      % if false_promises.number() == 1:
      If you were more likely to sign the lease **because** of 
      your landlord's promise, answer yes.
      % else:
      If you were more likely to sign the lease **because** of 
      your landlord's promises, answer yes.
      % endif
      % else: 
      % if false_promises.number() == 1:
      If the tenant was more likely to sign the lease **because** of 
      the landlord's promise, answer yes.
      % else:
      If the tenant was more likely to sign the lease **because** of 
      the landlord's promises, answer yes.
      % endif
      % endif
---
code: |
  if late_fees_assessed and late_fees_penalty:
    defense_liquidated_damages_late_fees = True
  else:
    defense_liquidated_damages_late_fees = False
depends on:
  - late_fees_assessed
  - late_fees_penalty
---
id: late fees
question: |
  % if person_answering == "tenant":
  Did your landlord say that you owe a late fee?
  % else: 
  Did the landlord say that the tenant owes a late fee?
  % endif
fields:
  - label: |
      % if person_answering == "tenant":
      Did your landlord say that you owe fees for paying rent late?
      % else: 
      Did the landlord say that the tenant owes fees for paying rent late?
      % endif
    field: late_fees_assessed
    datatype: yesnoradio
  - label: |
      % if person_answering == "tenant":
      Is your rent more than a fair amount to cover the landlord's cost?
      % else: 
      Is the tenant's rent more than a fair amount to cover the landlord's cost?
      % endif
    field: late_fees_penalty
    datatype: yesnomaybe
    show if: late_fees_assessed
  - note: |
      It is up to a judge to decide if the late fee is "fair". But if the late fee is
      a lot more than:

      * The interest the money could earn in a bank, plus
      * The cost of the landlord's time to handle the late payment,

      The fee may be too high.
    show if: late_fees_assessed
---
comment: |
  Are we going to separate levels of cqe breach? E.g. (1) mere breach, (2) constructive eviction, (3) significant enough to physically deprive the tenant of possession.
code: |
  if cqe_breaches.any_true():
    defense_breach_of_cqe = True
  else:
    defense_breach_of_cqe = False
depends on: cqe_breaches
---
code: |
  if estoppel_breaches.any_true() or defense_breach_of_cqe:
    defense_estoppel_illegality = True
  else:
    defense_estoppel_illegality = False
depends on:
  - estoppel_breaches
  - defense_breach_of_cqe
---
code: |
  if warranty_breaches.any_true():
    defense_breach_of_habitability = True
  else:
    defense_breach_of_habitability = False
depends on:
  - warranty_breaches
---
code: |
  if landlord_foreclosed and not notice_of_foreclosure:
    defense_foreclosure = True
  else:
    defense_foreclosure = False
depends on:
  - landlord_foreclosed
  - notice_of_foreclosure
---
id: had foreclosure
question: |
  Did the bank ever foreclose on this home?
fields:
  - label: |
      % if person_answering == "tenant":
      Did the bank foreclose on this property while you lived there?
      % else: 
      Did the bank foreclose on this property while the tenant lived there?
      % endif
    field: landlord_foreclosed
    datatype: yesnomaybe
  - label: |
      % if person_answering == "tenant":
      Did you get a letter that told you about the foreclosure?
      % else: 
      Did the tenant get a letter that told them about the foreclosure?
      % endif
    field: notice_of_foreclosure
    datatype: yesnomaybe
    show if: landlord_foreclosed
---
code: |
  if previous_landlord_sold_property and (notice_of_sale_provided_new_landlord == False or not notice_contains_sale_document == False):
    defense_new_owner_failed_to_provide_notice_of_sale = True
  else:
    defense_new_owner_failed_to_provide_notice_of_sale = False
depends on:
  - previous_landlord_sold_property
  - notice_of_sale_provided_new_landlord
  - notice_contains_sale_document
  - trial_court.classification
---
depends on: trial_court.classification
if: |
  trial_court.classification != 1
id: sale of property
question: |
  Did your landlord ever sell the house while you were a tenant at this address?
fields:
  - Was your house sold to a new landlord while you lived in it?: previous_landlord_sold_property
    datatype: yesnomaybe
  - Did your new landlord give you a letter that told you about the sale?: notice_of_sale_provided_new_landlord
    datatype: yesnomaybe
    show if: previous_landlord_sold_property
  - Did that letter have a copy of the deed?: notice_contains_sale_document
    datatype: yesnomaybe
    show if: notice_of_sale_provided_new_landlord
---
depends on: trial_court.classification
if: |
  trial_court.classification == 1
id: sale of property
question: |
  % if person_answering == "tenant":
  Did your landlord ever sell the house while you were living at this address?
  % else:
  Did the landlord ever sell the house while the tenant was living at this address?
  % endif
fields:
  - label: |
      % if person_answering == "tenant":
      Was your house sold to a new landlord while you lived in it?
      % else: 
      Was the house sold to a new landlord while the tenant lived in it?
      % endif
    field: previous_landlord_sold_property
    datatype: yesnomaybe
  - label: |
      % if person_answering == "tenant":
      Did your new landlord give you a letter that told you about the sale?
      % else: 
      Did the new landlord give the tenant a letter that told them about the sale?
      % endif
    field: notice_of_sale_provided_new_landlord
    datatype: yesnomaybe
    show if: previous_landlord_sold_property
  - Did that letter have a copy of the deed, or a notarized document signed both by the original landlord and the new landlord?: notice_contains_sale_document
    datatype: yesnomaybe
    show if: notice_of_sale_provided_new_landlord
---
code: |
  temp_counter = 0
  for op in other_parties:
    if not op.attorney.there_are_any and op.person_type == "business":
      temp_counter += 1
  if temp_counter > 0:
      defense_unrepresented_corporation = True
  else:
      defense_unrepresented_corporation = False
depends on:
  - other_parties
---
code: |
  if defense_lease_not_attached or defense_lease_signed_under_duress or defense_fraud_lease:
    defense_no_landlord_tenant_relationship = True
  else:
    defense_no_landlord_tenant_relationship = False
depends on:
  - defense_lease_not_attached
  - defense_lease_signed_under_duress
  - defense_fraud_lease
---
code: |
  if is_rent_subsidized and excessive_rent:
    defense_excessive_rent_for_subsidized_housing = True
  else:
    defense_excessive_rent_for_subsidized_housing = False
depends on:
  - is_rent_subsidized
  - excessive_rent
---
id: subsidized housing identification
question: |
  % if person_answering == "tenant":
  What kind of housing do you have?
  % else: 
  What kind of housing does the tenant have?
  % endif
fields:
  - label: |
      % if person_answering == "tenant":
      Do you get a rent subsidy or do you live in public housing?
      % else: 
      Does the tenant get a rent subsidy or do they live in public housing?
      % endif
    field: is_rent_subsidized
    datatype: yesnoradio
  - label: |
      % if person_answering == "tenant":
      What type of housing do you have?
      % else: 
      What type of housing does the tenant have?
      % endif
    field: subsidized_housing_type
    datatype: radio
    choices:
      - ${ subsidized_housing_text["voucher"] }: voucher
      - ${ subsidized_housing_text["public"] }: public
        help: |
          % if person_answering == "tenant":
          In public housing, your landlord is usually the city or county.
          % else:
          In public housing, the tenant's landlord is usually the city or 
          county.
          % endif
      - ${ subsidized_housing_text["taxcredit"] }: taxcredit
      - ${ subsidized_housing_text["project"] }: project   
    show if:
      variable: is_rent_subsidized
      is: True
---
variable name: subsidized_housing_text
use objects: True
data:
  voucher:
    question: Section 8 voucher
    document: Section 8 voucher
  public:
    question: Public housing
    document: Public housing
  taxcredit:
    question: Tax Credit
    document: Tax Credit
  project:
    question: |
      ${ "Housing project run by a private landlord (and I pay 30% of my income for rent)" if person_answering == "tenant" else "Housing project run by a private landlord (and the tenant pays 30% of their income for rent)"}  
    document: |
      ${ "Housing project run by a private landlord (and I pay 30% of my income for rent)" if person_answering == "tenant" else "Housing project run by a private landlord (and the tenant pays 30% of their income for rent)"}  
  
---
id: rent not owed by tenant
question: |
  % if person_answering == "tenant":
  Because you get a rent subsidy
  % else:
  Because the tenant gets a rent subsidy
  % endif
subquestion: |
  Some landlords ask their tenant to pay:

  * Extra rent that is more than the rent the housing authority said the landlord can charge, or
  * Part of the rent the housing authority would normally pay but the housing authority has stopped payment.

  % if person_answering == "tenant":
  Your landlord can only charge you the amount that your Section 8 contract says. You never owe more than your tenant rent share.
  % else:
  The tenant's landlord can only charge them the amount that their Section 8 contract says. The tenant never owes more than their tenant rent share.
  % endif
fields:
  - label: |
      % if person_answering == "tenant":
      Is your landlord asking you to pay an amount that is more than your tenant rent share?
      % else: 
      Is the tenant's landlord asking them to pay an amount that is more than their tenant rent share?
      % endif
    field: excessive_rent
    datatype: yesnoradio
---
