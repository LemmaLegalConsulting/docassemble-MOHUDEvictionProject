---
modules:
  - .defenses
---
id:  defense logic order
comment: |
  This can't be the best way to do this. Can a DADict act like a checkboxes dictionary?
code: |
  defense_vawa
  defense_reasonable_accommodation
  defense_discrimination
  defense_ll_refused_section_8
  if eviction_reason["nonpayment of rent"]:
    defense_rent_pleading_requirement
  defense_lease_not_attached
  if eviction_reason["nonpayment of rent"]:
    defense_tender_refused
    defense_rent_payment
    defense_excessive_rent_for_subsidized_housing
  defense_settlement
  defense_lease_signed_under_duress
  defense_fraud_lease
  if eviction_reason["nonpayment of rent"]:
    defense_liquidated_damages_late_fees
  if eviction_reason["nonpayment of rent"]:
    defense_breach_of_habitability
    defense_breach_of_cqe
    defense_estoppel_illegality
  defense_foreclosure
  defense_new_owner_failed_to_provide_notice_of_sale
  defense_unrepresented_corporation
  
  # UD defenses
  defense_ud_no_written_notice
  defense_ud_no_rental_period_notice
  defense_ud_lease_requirements
  defense_termination_notice_required_by_law
  defense_failure_to_terminate

  defense_logic = True
---
depends on:
  - defense_no_breach
  - defense_breach_not_material
code: |
  if case_type["AC Unlawful Detainer"]:
    defense_ud_did_not_violate_lease = (
      defense_no_breach or
      defense_breach_not_material
    )
  else:
    defense_ud_did_not_violate_lease = None
---
depends on:
  - got_notice_to_terminate
  - has_written_lease
  - lease_says_how_much_notice
  - landlord_gave_notice_required_by_lease
code: |
  if case_type["AC Unlawful Detainer"]:
    defense_ud_lease_requirements = got_notice_to_terminate and (
      has_written_lease and
      lease_says_how_much_notice and
      not landlord_gave_notice_required_by_lease
    )
  else:
    defense_ud_lease_requirements = None
---
code: |
  # See: 24 C.F.R. ยง 247.4 (c)
  # COVID-19 emergency currently not in effect
  is_federal_emergency = False
---
depends on:
  - is_federal_emergency
  - case_type
  - eviction_reason
  - subsidized_housing_type
  - received_notice_date
  - notice_to_terminate_includes_specific_day
  - termination_of_tenancy_date
code: |
  if case_type["AC Unlawful Detainer"]:
    defense_termination_notice_required_by_law = got_notice_to_terminate and has_improper_notice_required_by_law(
        is_federal_emergency,
        eviction_reason,
        is_rent_subsidized,
        received_notice_date,
        notice_to_terminate_includes_specific_day,
        showifdef("rent_day", 1),
        showifdef("rent_period", 12),
        showifdef("termination_of_tenancy_date") or None,
    )
  else:
    defense_termination_notice_required_by_law = None
---
depends on:
  - case_type
  - got_notice_to_terminate
  - defense_ud_no_written_notice
  - defense_ud_no_rental_period_notice
  - defense_ud_lease_requirements
  - defense_termination_notice_required_by_law
code: |
  if case_type['AC Unlawful Detainer']:
    defense_failure_to_terminate = (not got_notice_to_terminate) or (
      defense_ud_no_written_notice or 
      defense_ud_no_rental_period_notice or
      defense_ud_lease_requirements or
      defense_termination_notice_required_by_law
    )
  else:
    defense_failure_to_terminate = None
---
id: rent pleadings requirement logic
depends on:
  - eviction_reason
  - tenant_got_summons
  - petition_available
  - petition_alleges_nonrent
  - petition_states_rent_amount
  - lease_attached
  - petition_states_terms_of_lease
  - petition_states_rent_periods
  - petition_states_demand_made
  - trial_court.circuit
  - petition_separates_nonrent
  - has_written_lease
code: |
  if eviction_reason["nonpayment of rent"] and tenant_got_summons and petition_available:
    if petition_alleges_nonrent or not petition_states_rent_amount or (not has_written_lease and not petition_states_terms_of_lease) or (has_written_lease and not lease_attached and not petition_states_terms_of_lease) or not petition_states_rent_periods or not petition_states_demand_made or (trial_court.circuit == 21 and not petition_separates_nonrent):
      defense_rent_pleading_requirement = True
    else:
      defense_rent_pleading_requirement = False
  else:
      defense_rent_pleading_requirement = None
---
id: lease not attached logic
depends on:
  - tenant_got_summons
  - petition_available
  - lease_attached
  - has_written_lease
code: |
  if tenant_got_summons and petition_available:
    if has_written_lease and not lease_attached:
      defense_lease_not_attached = True
    else:
      defense_lease_not_attached = False
  else:
      defense_lease_not_attached = None
---
id: tender refused logic
depends on:
  - eviction_reason
  - offer_attempts
code: |
  if eviction_reason["nonpayment of rent"]:
    defense_tender_refused = False
    if offer_attempts.there_are_any:
      for offer in offer_attempts:
        if offer.has_refused_payment and offer.was_attempt_full:
          defense_tender_refused = True
  else:
    defense_tender_refused = None
comment: |
  add date requirement
---
id: rent payment defense logic
code: |
  if eviction_reason["nonpayment of rent"] and was_rent_paid:
    defense_rent_payment = True
  elif eviction_reason["nonpayment of rent"] and not was_rent_paid:
    defense_rent_payment = False
  else:
    defense_rent_payment = None    
depends on:
  - eviction_reason
  - was_rent_paid
---
id: settlement defense logic
code: |
  if landlord_agreement and tenant_compliance_with_agreement:
    defense_settlement = True
  else:
    defense_settlement = False
depends on:
  - landlord_agreement
  - tenant_compliance_with_agreement
---
id: made settlement
question: |
  % if person_answering == "tenant":
  Did you already make an agreement with your landlord to stop the {eviction}?
  % else: 
  Did the tenant already make an agreement with their landlord to stop the {eviction}?
  % endif
subquestion: |
  A landlord and tenant can agree to "settle" an eviction case, which means an agreement to stop the eviction.
fields:
  - label: |
      % if person_answering == "tenant":
      Did you make a {settlement|settlement agreement} with your landlord?
      % else: 
      Did the tenant make a {settlement|settlement agreement} with their landlord?
      % endif
    field: landlord_agreement
    datatype: yesnoradio
  - label: |
      % if person_answering == "tenant":
      Did you follow the terms of the agreement?
      % else: 
      Did the tenant follow the terms of the agreement?
      % endif
    field: tenant_compliance_with_agreement
    datatype: yesnoradio
    show if: landlord_agreement
---
id: unfair duress defense logic
code: |
  defense_lease_signed_under_duress = unfair_duress
depends on:
  - unfair_duress
---
id: duress
question: |
  % if person_answering == "tenant":
  Did the landlord unfairly pressure you to enter this lease?
  % else: 
  Did the landlord unfairly pressure the tenant to enter this lease?
  % endif
subquestion: |
  ${ collapse_template(unfair_duress_explanation_template) }
fields:
  - label: |
      % if person_answering == "tenant":
      Did the landlord unfairly pressure you to enter this lease?
      % else: 
      Did the landlord unfairly pressure the tenant to enter this lease?
      % endif
    field: unfair_duress
    datatype: yesnoradio
---
template: unfair_duress_explanation_template
subject: |
  What counts as "unfair pressure"?
content: |
  Only a judge can decide. But unfair pressure may include:
  
  * A threat to hurt you or someone else,
  * An **implied** threat to hurt you or someone else, or
  * Extreme psychological pressure.
---
id: false promises defense logic
code: |
  if false_promises_exists:
    defense_fraud_lease = True
  else:
    defense_fraud_lease = False
---
#code: |
#  if false_promises_exists and relied_on_false_promises:
#    defense_fraud_lease = True
#  else:
#    defense_fraud_lease = False
#depends on:
#  - false_promises_exists
#  - relied_on_false_promises
---
id: landlord lied
question: |
  % if person_answering == "tenant":
  Did your landlord tell you something that was not true to get you to enter this lease?
  % else:
  Did the landlord tell the tenant something that was not true to get them to enter this lease?
  % endif
subquestion: |
  % if person_answering == "tenant":
  If your landlord tricked you into this lease by telling you
  something that was not true, you may have a {defense}.
  % else:
  If the tenant's landlord tricked them into this lease by telling them
  something that was not true, they may have a {defense}.
  % endif
  
  ${ collapse_template(false_promise_example_template) }
fields:
  - label: |
      % if person_answering == "tenant":
      Did your landlord make any false promises to you to get you to enter this lease?
      % else: 
      Did the landlord make any false promises to the tenant to get them to enter this lease?
      % endif
    field: false_promises_exists
    datatype: yesnoradio
  - label: |
      % if person_answering == "tenant":
      What false promises did your landlord make to you?
      % else: 
      What false promises did the landlord make to the tenant?
      % endif
    field: false_promises
    datatype: area
    show if: false_promises_exists
---
template: false_promise_example_template
subject: |
  What counts as a false promise?
content: |
  If your landlord told you something that got you to enter the lease and
  what they said was not true, it may be a false promise.

  For example:

  * Promising to paint a room,
  * Promising to replace a carpet, or
  * Promising that an old appliance would be replaced before you moved in.

  A false promise can also be a written promise, or a promise in an advertisement.
---
#id: relied on promise
#question: |
#  % if person_answering == "tenant":
#  Did your landlord's promise get you to sign the lease?
#  % else: 
#  Did the landlord's promise get the tenant to sign the lease?
#  % endif
#subquestion: |
#  You told us the landlord made the false promise:
#  
#  - ${ false_promises }
#  
#fields:
#  - note: |
#      % if person_answering == "tenant":
#      If you were more likely to sign the lease **because** of 
#      your landlord's promises, answer yes.
#      % else: 
#      If the tenant was more likely to sign the lease **because** of 
#      the landlord's promises, answer yes.
#      % endif
#  - label: |
#      % if person_answering == "tenant":
#      Did your landlord's promises get you to sign the lease?
#      % else: 
#      Did the landlord's promises get the tenant to sign the lease?
#      % endif
#    field: relied_on_false_promises
#    datatype: yesnoradio
---
id: late fees defense logic
code: |
  if late_fees_assessed and (late_fees_penalty or ((not late_fees_lease_provision) or late_fee_doesnt_comply_with_lease)):
    defense_liquidated_damages_late_fees = True
  else:
    defense_liquidated_damages_late_fees = False
depends on:
  - late_fees_assessed
  - late_fees_penalty
  - late_fees_lease_provision
  - late_fee_doesnt_comply_with_lease
---
id: late fees
question: |
  % if person_answering == "tenant":
  Did your landlord say that you owe a late fee?
  % else: 
  Did the landlord say that the tenant owes a late fee?
  % endif
fields:
  - label: |
      % if person_answering == "tenant":
      Did your landlord say that you owe fees for paying rent late?
      % else: 
      Did the landlord say that the tenant owes fees for paying rent late?
      % endif
    field: late_fees_assessed
    datatype: yesnoradio
  - note: |
      <h2 class="h4">Was the amount the landlord charged "fair"?</h2>
      It is up to a judge to decide if the late fee is "fair". But if the late fee is
      a lot more than:

      * The interest the money could earn in a bank, plus
      * The cost of the landlord's time to handle the late payment,

      The fee may be too high.
      
      In some counties, more than $5 per day is considered too high.
    show if: late_fees_assessed
  - label: |
      % if person_answering == "tenant":
      Is the late fee more than a fair amount to cover the landlord's cost?
      % else: 
      Is the tenant's late fee more than a fair amount to cover the landlord's cost?
      % endif
    field: late_fees_penalty
    datatype: yesnomaybe
    show if: late_fees_assessed
  - label: |
      Is there a part of the {lease} that allows the landlord to charge the late fee?
      % if has_written_lease == False:
      You can answer no if you don't have a written lease.
      % endif
    field: late_fees_lease_provision
    datatype: yesnomaybe
    show if: 
      variable: late_fees_assessed
      is: True
  - label: |
      Do the late fees charged by the landlord comply with the lease provision?
      % if has_written_lease == False:
      You can answer no if you don't have a written lease.
      % endif
    field: late_fee_doesnt_comply_with_lease
    datatype: noyesmaybe
    show if: late_fees_lease_provision
---
id: cqe breach logic
comment: |
  Are we going to separate levels of cqe breach? E.g. (1) mere breach, (2) constructive eviction, (3) significant enough to physically deprive the tenant of possession.
code: |
  if eviction_reason["nonpayment of rent"] and cqe_breaches.any_true():
    defense_breach_of_cqe = True
  elif eviction_reason["nonpayment of rent"] and not cqe_breaches.any_true():
    defense_breach_of_cqe = False
  else:
    defense_breach_of_cqe = None
depends on:
  - eviction_reason
  - cqe_breaches
---
id: estoppel defense logic
code: |
  if eviction_reason["nonpayment of rent"]:
    if estoppel_breaches.any_true() or defense_breach_of_cqe:
      defense_estoppel_illegality = True
    else:
      defense_estoppel_illegality = False
  else:
    defense_estoppel_illegality = None
depends on:
  - eviction_reason
  - estoppel_breaches
  - defense_breach_of_cqe
---
id: warranty breach logic
code: |
  if eviction_reason["nonpayment of rent"] and warranty_breaches.any_true():
    defense_breach_of_habitability = True
  elif eviction_reason["nonpayment of rent"] and not warranty_breaches.any_true():
    defense_breach_of_habitability = False
  else:
    defense_breach_of_habitability = None
depends on:
  - eviction_reason
  - warranty_breaches
  - notice_of_breach_to_landlord
---
id: notice of problems fact
question: |
  % if person_answering == "tenant":
  Did you tell the landlord about the problems that needed to get repaired?
  % else: 
  Did the tenant tell the landlord about the problems that needed to get repaired?
  % endif
fields:
  - label: |
      % if person_answering == "tenant":
      Did you let the landlord know about at least one of these problems, either by writing to the landlord or talking to the landlord?
      % else: 
      Did the tenant let the landlord know about at least one of these problems, either by writing to the landlord or talking to the landlord?
      % endif
    field: notice_of_breach_to_landlord
    datatype: yesnomaybe
---
id: foreclosure defense logic
code: |
  if landlord_foreclosed and not notice_of_foreclosure:
    defense_foreclosure = True
  else:
    defense_foreclosure = False
depends on:
  - landlord_foreclosed
  - notice_of_foreclosure
---
id: had foreclosure
question: |
  Did the bank ever foreclose on this home?
fields:
  - label: |
      % if person_answering == "tenant":
      As far as you know during the time that you were a tenant, did a bank {foreclosure|foreclose} on the property?
      % else: 
      As far as you know during the time that the tenant lived in the property, did a bank {foreclosure|foreclose} on the property?
      % endif
    field: landlord_foreclosed
    datatype: yesnomaybe
  - label: |
      % if person_answering == "tenant":
      Did you get a letter that told you about the foreclosure?
      % else: 
      Did the tenant get a letter that told them about the foreclosure?
      % endif
    field: notice_of_foreclosure
    datatype: yesnomaybe
    show if: landlord_foreclosed
---
id: new owner logic for all counties
code: |
  if previous_landlord_sold_property and (notice_of_sale_provided_new_landlord == False or notice_contains_sale_document == False):
    defense_new_owner_failed_to_provide_notice_of_sale = True
  else:
    defense_new_owner_failed_to_provide_notice_of_sale = False
depends on:
  - previous_landlord_sold_property
  - notice_of_sale_provided_new_landlord
  - notice_contains_sale_document
  - trial_court.classification
---
depends on: trial_court.classification
if: |
  trial_court.classification.strip() != "Class 1"
id: new owner facts for non-class 1 counties
question: |
  % if person_answering == "tenant":
  Did your landlord ever sell the house while you were a tenant at this address?
  % else:
  Did the landlord ever sell the house while the tenant lived at this address?
  % endif
  
fields:
  - label: |
      % if person_answering == "tenant":
      Was your house sold to a new landlord while you lived in it?
      % else:
      Was the tenant's house sold to a new landlord while they lived in it?
      % endif
    datatype: yesnomaybe
    field: previous_landlord_sold_property
    
  - label: |
      % if person_answering == "tenant":
      Did your new landlord give you a letter that told you about the sale?
      % else: 
      Did the tenant's new landlord give them a letter that told them about the sale?
      % endif
    datatype: yesnomaybe
    field: notice_of_sale_provided_new_landlord
    show if: previous_landlord_sold_property
  - Did that letter have a copy of the deed?: notice_contains_sale_document
    datatype: yesnomaybe
    show if: notice_of_sale_provided_new_landlord
---
depends on: trial_court.classification
if: |
  trial_court.classification.strip() == "Class 1"
id: new owner facts for class 1 counties
question: |
  % if person_answering == "tenant":
  Did your landlord ever sell the house while you were living at this address?
  % else:
  Did the landlord ever sell the house while the tenant was living at this address?
  % endif
fields:
  - label: |
      % if person_answering == "tenant":
      Was your house sold to a new landlord while you lived in it?
      % else: 
      Was the house sold to a new landlord while the tenant lived in it?
      % endif
    field: previous_landlord_sold_property
    datatype: yesnomaybe
  - label: |
      % if person_answering == "tenant":
      Did your new landlord give you a letter that told you about the sale?
      % else: 
      Did the new landlord give the tenant a letter that told them about the sale?
      % endif
    field: notice_of_sale_provided_new_landlord
    datatype: yesnomaybe
    show if: previous_landlord_sold_property
  - Did that letter have a copy of the deed, or a notarized document signed both by the original landlord and the new landlord?: notice_contains_sale_document
    datatype: yesnomaybe
    show if: notice_of_sale_provided_new_landlord
---
id: unrepresented landlord defense logic
code: |
  temp_counter = 0
  for op in other_parties:
    if not op.attorney.there_are_any and op.person_type == "business":
      temp_counter += 1
  if temp_counter > 0:
      defense_unrepresented_corporation = True
  else:
      defense_unrepresented_corporation = False
depends on:
  - other_parties
---
id: subsidized excessive rent defense
code: |
  if is_rent_subsidized and excessive_rent:
    defense_excessive_rent_for_subsidized_housing = True
  else:
    defense_excessive_rent_for_subsidized_housing = False
depends on:
  - is_rent_subsidized
  - excessive_rent
---
variable name: times_per_year_list
data:
  - [52, "Weekly"]
  - [26, "Once every two weeks"]
  - [24, "Twice per month"]
  - [12, "Monthly"]
  - [4, "Once every 3 months"]
  - [2, "Once every 6 months"]
  - [1, "Yearly"]  
---
id: subsidized housing identification
question: |
  % if person_answering == "tenant":
  What kind of housing do you have?
  % else: 
  What kind of housing does the tenant have?
  % endif
subquestion: |
  % if person_answering == "tenant":
  It may help to look at your lease to answer this question.
  
  If you do not have it, do your best to answer from your memory.
  % else:
  It may help to look at the tenant's lease to answer this question.
  % endif
  

  ${ collapse_template(why_tenancy_facts_template) }
fields:
  - label: |
      % if person_answering == "tenant":
      Do you live in subsidized housing, including getting a rent {subsidy} or living in public housing?
      % else: 
      Does the tenant live in subsidized housing, including getting a rent {subsidy} or living in public housing?
      % endif
    field: is_rent_subsidized
    datatype: yesnoradio
  - label: |
      What kind?
    field: subsidized_housing_type
    datatype: radio
    choices:
      - ${ subsidized_housing_text["voucher"] }: voucher
      - ${ subsidized_housing_text["public"] }: public
        help: |
          % if person_answering == "tenant":
          In public housing, your landlord is usually the city or county.
          % else:
          In public housing, the tenant's landlord is usually the city or 
          county.
          % endif
      - ${ subsidized_housing_text["taxcredit"] }: taxcredit
      - ${ subsidized_housing_text["project"] }: project   
    show if:
      variable: is_rent_subsidized
      is: True
  - label: |
      % if person_answering == "tenant":
      Do you live in a mobile home that you own and rent the land?
      % else: 
      Does the tenant live in a mobile home that they own and rent the land?
      % endif
    field: is_mobile_home_owner
    datatype: yesnoradio
    show if:
      variable: is_rent_subsidized
      is: False
  - label: |
      How many units are in the building or apartment complex?
    field: number_of_units_in_building
    input type: radio
    show if:
      variable: is_rent_subsidized
      is: False
    choices:
      - One (single-family): one
      - More than 1 but fewer than 4: fewer_than_four
      - 4 or more: four_or_more
  - label: |
      % if person_answering == "tenant":
      What kind of lease do you have?
      % else:
      What kind of lease does the tenant have?
      % endif
    field: kind_of_lease_agreement
    input type: radio
    choices:
      - ${ lease_type_text['fixed_period'] }: fixed_period
      - ${ lease_type_text['periodic'] }: periodic
      - ${ lease_type_text['no_written_lease'] }: no_written_lease
      - ${ lease_type_text['dont_know'] }: dont_know
  - What day does the lease end?: fixed_period_end_date
    datatype: date
    show if:
      variable: kind_of_lease_agreement
      is: fixed_period
  - label: |
      **Self-extending leases.**

      Some leases include a term that says the lease will automatically renew
      or that it will turn into a month-to-month lease when the term ends.

      For example: _"a new tenancy from month-to-month shall be created between Landlord and Tenant...,"_
      or: _"This lease shall automatically renew for successive terms ... unless..."_

      Does this lease include a {term} like that?
    label above field: True
    show if:
      variable: kind_of_lease_agreement
      is: fixed_period
    field: is_self_extending_lease
    datatype: yesnomaybe
  - label: |
      **How often** is rent due?
    field: rent_period
    datatype: integer
    input type: radio
    code: |
      times_per_year_list
    show if:
      variable: kind_of_lease_agreement
      is: periodic
  - label: |
      What **day** is rent due?
      (enter a number, like **1** for the first day of the month or week)
    help: |
      The most common rent days are the first and the 5th of the month.
    field: rent_day
    datatype: integer
    show if:
      variable: kind_of_lease_agreement
      is: periodic
---
variable name: lease_type_text
use objects: True
data:
  fixed_period:
    question: A lease for a fixed period of time (like 1 year)
    document: A lease for a fixed period of time (like 1 year)   
  periodic:
    question: A month-to-month, week-to-week or other lease that automatically renews
    document: A month-to-month, week-to-week or other lease that automatically renews
  no_written_lease:
    question: No written lease
    document: No written lease
  dont_know:
    question: Unknown
    document: Unknown
---
template: why_tenancy_facts_template
subject: |
  Why does this matter?
content: |
  The questions on this page help decide:

  * what kind of {notice} the landlord must give
  * whether your landlord must follow discrimination laws

  Depending on your answer, there may be a {defense} to the eviction.
---
id: disability
question: |
  Disability and reasonable accommodation
subquestion: |
  % if person_answering == "tenant":
  If you have a disability, you have the right to use your housing in the same 
  way as someone without a disability.

  You may have the right to a change in:

  * The rules of your housing, or
  * The physical structure of your housing.
  
  If the change would help you stay in your housing or solve the problem that
  the landlord is complaining about, it may be a defense (stop your eviction).

  The disability can be yours or it can be a disability of someone in your
  household.
  % else:
  If the tenant has a disability, they have the right to use their housing in the same 
  way as someone without a disability.

  The tenant may have the right to a change in:

  * The rules of your housing, or
  * The physical structure of their housing.
  
  If the change would help them stay in their housing or solve the problem that
  the landlord is complaining about, it may be a defense (stop the tenant's eviction).

  The disability can be the tenant's or it can be a disability of someone in their
  household.
  % endif
  
  ${ collapse_template(what_is_disability_template) }

  ${ collapse_template(disability_defense_example_template) }
fields:
  - label: |
      % if person_answering == "tenant":
      Do you or does someone who lives with you have a disability?
      % else:
      Does the tenant or a household member have a disability?
      % endif
    field: tenant_has_disability
    datatype: yesnomaybe
  - label: |
      What is the disability?
      (optional)
    field: tenant_disability
    show if: tenant_has_disability
    required: False
    help: |
      You do not have to say what the disability is. But it may help the judge
      to know.
  - label: |
      % if person_answering == "tenant":
      Would a change in the rules or the physical structure of your housing help you use or stay in your housing?
      % else:
      Would a change in the rules or the physical structure of the tenant's housing help them use or stay in their housing?
      % endif
    field: tenant_needs_accommodation
    datatype: yesnomaybe
    show if: tenant_has_disability
  - How? (optional): tenant_accommodation_description
    show if: tenant_needs_accommodation
    required: False
    datatype: area
    help: |
      Explain the connection between the disability, the change you need,
      and how the change could prevent the need for the eviction.
  - Is the change "reasonable"?: tenant_accommodation_reasonable
    show if: tenant_needs_accommodation
    datatype: yesnomaybe
    help: |
      It is up to a judge to decide if a change is reasonable. But think about the cost
      and impact on the landlord of making the change.
  - label: |
      % if person_answering == "tenant":
      Did you **ask** your landlord to change the rules or the physical structure of your housing?
      % else:
      Did the tenant **ask** their landlord to change the rules or the physical structure of their housing?
      % endif
    field: tenant_asked_for_accommodation
    datatype: yesnomaybe
    js show if: | 
      val("tenant_has_disability") && val("tenant_needs_accommodation")
  - label: |
      % if person_answering == "tenant":
      Would you like to ask now?
      % else:
      Would the tenant like to ask now?
      % endif
    field: tenant_wants_accommodation_in_answer
    datatype: yesnoradio
    show if: 
      variable: tenant_asked_for_accommodation
      is: False
  - label: |
      % if person_answering == "tenant":
      Did your landlord say **no**?
      % else:
      Did the tenant's landlord **refuse** the request?
      % endif
    field: landlord_refused_accommodation
    datatype: yesnomaybe
    show if: tenant_asked_for_accommodation
---
template: disability_defense_example_template
subject: |
  Can you give me an example?
content: |
  <h2 class="h4">Example 1: child making noise</h2>
  A tenant's child with autism made a lot of noise.

  The tenant asked the landlord to give them time to see if the child's new therapy
  would help reduce the noise. They also offered to use rugs on more floors.

  <h2 class="h4">Example 2: late payment of rent</h2>
  A tenant's disability check often came late, making the tenant late when paying
  their rent.

  The tenant asked the landlord to move the rent due date to the 10th of each month.

  <h2 class="h4">What happened</h2>
  In both examples above, a judge ordered the landlord to accept the tenant's request
  for a change in the rules and to stop the eviction, because:

  * the request was related to the disability, and
  * it was reasonable (something the landlord could do without too much cost or trouble).
---
depends on:
  - tenant_has_disability
  - tenant_needs_accommodation
  - tenant_asked_for_accommodation
code: |
  defense_reasonable_accommodation = tenant_has_disability and tenant_needs_accommodation and tenant_asked_for_accommodation and landlord_refused_accommodation
---
id: st louis section 8 protection
question: |
  Section 8 protection for tenants in St Louis
subquestion: |
  If you live in St Louis, your landlord cannot refuse to accept a Section 8
  voucher.
fields:
  - label: |
      % if person_answering == "tenant":
      Did your landlord refuse to accept your Section 8 voucher?
      % else:
      Did the tenant's landlord refuse to accept their Section 8 voucher?
      % endif
    field: landlord_refused_section_8
    datatype: yesnoradio
---
depends on:
  - users[0].address.city
  - landlord_refused_section_8
code: |
  defense_ll_refused_section_8 = users[0].normalized_address().city == "St. Louis" and landlord_refused_section_8
---
template: what_is_disability_template
subject: |
  What is a disability?
content: |
  A disability is a physical or mental impairment that substantially limits one or more major life activities.

  Major life activities include:

  * Caring for yourself
  * Seeing
  * Hearing
  * Communicating
  * Working
  % if person_answering == "tenant":
  * And other things you may need to do in your daily life.

  You do **not** need to be disabled all the time to have a disability.
  You do not need a doctor's diagnosis to have a disability. But a diagnosis 
  may help to prove your case in court.
  % else:
  * And other things the tenant may need to do in their daily life.

  The tenant does **not** need to be disabled all the time to have a disability.
  They do not need a doctor's diagnosis to have a disability. But a diagnosis 
  may help to prove their case in court.
  % endif
---
id: discrimination
question: |
  Discrimination
subquestion: |
  % if person_answering == 'tenant':
  You have the right to be free from discrimination in housing.

  If:

  1. You are a member of a protected class, and
  2. The reason you are being treated differently or denied housing is 
     **because** of your protected class,

  Discrimination law protects you from:
  % else:
  The tenant has the right to be free from discrimination in housing.

  If:

  1. The tenant is a member of a protected class, and
  2. The reason the tenant is being treated differently or denied housing is 
     **because** of their protected class,

  Discrimination law protects the tenant from:
  % endif
  
  * Being treated differently,
  * Being denied housing, or
  * Being unfairly evicted.
fields:
  - label: |
      % if person_answering == 'tenant':
      I believe my landlord is discriminating against me
      % else:
      The landlord discriminated against the tenant
      % endif
    field: tenant_believes_discrimination
    datatype: yesnoradio
  - label: |
      % if person_answering == "tenant":
      I believe my landlord is discriminating against me because of
      % else:
      The tenant believes their landlord is discriminating against them because of
      % endif
    field: tenant_protected_classes
    datatype: checkboxes
    show if: tenant_believes_discrimination
    choices:
      - Family status (for example, having children): family status
      - Marital status (for example, being unmarried): marital status
      - Race: race
      - Skin color: skin color
      - Religion: religion
      - Sex (e.g., being born male, female or intersex): sex
      - Sex stereotyping related to gender identity or expression: sex stereotyping related to gender identity or expression
        help: |
          Although Missouri does not have a law that protects people who are gay or transgender, it does
          protect people who are being discriminated against because of how they express their gender, including
          if it does not match the cultural expectation for their sex.
      - Ancestry: ancestry
      - National origin (the country my family comes from): national origin
      - Disability: disability
    none of the above: False
  - Explain (optional): tenant_discrimination_explanation
    datatype: area
    required: False
    js show if: |
      val("tenant_protected_classes").length > 0
---
depends on:
  - tenant_believes_discrimination
  - tenant_protected_classes
code: |
  defense_discrimination = (
    (is_rent_subsidized or number_of_units_in_building == "four_or_more") and
    tenant_believes_discrimination and tenant_protected_classes.any_true()
  )
---
id: violence against women act defenses
question: |
  Violence Against Women Act (VAWA)
subquestion: |
  % if person_answering == "tenant":
  If you are a survivor of:
  % else:
  If the tenant is a survivor of:
  % endif
  
  * Domestic violence,
  * Dating violence,
  * Sexual assault, or
  * Stalking

  % if person_answering == "tenant":
  And you are being evicted **because** of something related to the
  domestic violence or abuse, you may have a defense.
  % else:
  And they are being evicted **because** of something related to the
  domestic violence or abuse, they may have a defense.
  % endif
  
  ${ collapse_template(dv_explanation_template) }
fields:
  - label: |
      % if person_answering == "tenant":
      Are you a survivor of domestic violence, dating violence, sexual assault, or stalking?
      % else:
      Is the tenant a survivor of domestic violence, dating violence, sexual assault, or stalking?
      % endif
    field: tenant_is_dv_survivor
    datatype: yesnomaybe
  - label: |
      % if person_answering == "tenant":
      Are you being evicted because of something related to the domestic violence or abuse?
      % else:
      Is the tenant being evicted because of something related to the domestic violence or abuse?
      % endif
    field: tenant_is_being_evicted_because_of_dv
    datatype: yesnomaybe
    show if: tenant_is_dv_survivor
  - Briefly explain (optional): tenant_dv_explanation
    datatype: area
    rows: 2
    required: False
    show if: tenant_is_being_evicted_because_of_dv
---
depends on:
  - is_rent_subsidized
  - tenant_is_dv_survivor
  - tenant_is_being_evicted_because_of_dv
code: |
  defense_vawa = (
    is_rent_subsidized and
    tenant_is_dv_survivor and 
    tenant_is_being_evicted_because_of_dv
  )
---
template: dv_explanation_template
subject: |
  Can you give me an example?
content: |
  A landlord wants to evict a tenant because: 

  * A survivor called the police to report the abuse, or
  * The abuser frequently came onto the property or stayed overnight even though there
    is a policy against overnight guests

  In both examples above, the landlord may not be legally allowed to evict
  the tenant, even though a tenant who was not a survivor of domestic violence
  could be evicted for the same reasons.
---
variable name: subsidized_housing_text
use objects: True
data:
  voucher:
    question: Mobile voucher (like Section 8)
    document: Section 8 housing choice voucher
  public:
    question: Public housing
    document: Public housing
  taxcredit:
    question: Tax Credit
    document: Tax Credit
  project:
    question: |
      ${ "Housing project run by a private landlord (and I pay 30% of my income for rent)" if person_answering == "tenant" else "Housing project run by a private landlord (and the tenant pays 30% of their income for rent)"}  
    document: |
      Section 8 project-based housing development
---
id: rent not owed by tenant
question: |
  % if person_answering == "tenant":
  Because you get a rent subsidy
  % else:
  Because the tenant gets a rent subsidy
  % endif
subquestion: |
  Some landlords ask their tenant to pay:

  * Extra rent that is more than the rent the housing authority said the landlord can charge, or
  * Part of the rent the housing authority would normally pay but the housing authority has stopped payment.

  % if person_answering == "tenant":
  Your landlord can only charge you the amount that you are responsible for, based on your income. You never owe more than your tenant rent share.
  % else:
  The tenant's landlord can only charge them the amount that the tenant is responsible for, based on their income. The tenant never owes more than their tenant rent share.
  % endif
fields:
  - label: |
      % if person_answering == "tenant":
      Is your landlord asking you to pay an amount that is more than your tenant rent share?
      % else: 
      Is the tenant's landlord asking them to pay an amount that is more than their tenant rent share?
      % endif
    field: excessive_rent
    datatype: yesnoradio
---
id: petition requirements - rent amount
question: |
  % if person_answering == "tenant":
  How much rent does your landlord say that you owe?
  % else: 
  How much rent does the tenant's landlord say that they owe?
  % endif
subquestion: |
  % if tenant_got_summons:
  Look at the Petition to answer this question.

  Look for a line that looks something like this:

  [FILE ComplaintRentAmount.png, 100%]

  The landlord's petition may look different.
  % endif
fields:
  - label: |
      % if person_answering == "tenant":
      Does the {petition} say what amount of rent you owe?
      % else:
      Does the {petition} say what amount of rent the tenant owes?
      % endif 
    field: petition_states_rent_amount
    datatype: yesnoradio
  - label: |
      % if person_answering == "tenant":
      How much does the Landlord's Petition say that you owe **in rent**?
      % else:
      How much does the Landlord's Petition say that the tenant owes **in rent**?
      % endif 
    field: rent_amount_owed
    datatype: currency
    show if: petition_states_rent_amount
  - label: |
      % if person_answering == "tenant":
      Does the petition say you owe an amount **other** than rent?  (Not including attorney fees and {court costs|costs from the eviction case}.)
      % else:
      Does the petition say the tenant owes an amount **other** than rent? (Not including attorney fees and {court costs|costs from the eviction case}.)
      % endif 
    field: other_charges_alleged
    datatype: yesnomaybe
  - note: |
      Other charges may include a pet fee, cleaning fee, fee for repairs, etc.
---
id: rent separated from other charges
question: |
  % if person_answering == "tenant":
  Does the {petition} separate the amount you owe in rent from other charges?
  % else:
  Does the {petition} separate the amount the tenant owes in rent from other charges?
  % endif
fields:
  - Are rent charges separated from other charges: petition_separates_nonrent
    datatype: yesnomaybe
---
depends on: petition_states_rent_amount
code: |
  if petition_states_rent_amount:
    petition_alleges_nonrent = False
  else:
    petition_alleges_nonrent = True
---
id: notice to terminate
question: |
  Notice to terminate tenancy
subquestion: |
  % if person_answering == "tenant":
  Your landlord must give you a notice to end your tenancy
  before filing an eviction case. 
  The amount of time that the landlord must give you depends on the kind 
  of tenancy you have.
  % else:
  The tenant's landlord must give the tenant a notice to end their tenancy
  before filing an eviction case.
  The amount of time that the landlord must give the tenant depends on the kind
  of tenancy the tenant has.
  % endif

  The notice might be called:

  * Lease termination,
  * Notice to Quit,
  * Notice to Terminate Tenancy, or
  * Notice to Vacate.

  There is no standard form for the notice.
  % if person_answering == "tenant":
  If you do not have the notice in front of you, do your best to answer
  from memory.
  % endif
fields:
  - label: |
      % if person_answering == "tenant":
      Did you get a written {notice} to end your tenancy?
      % else:
      Did the tenant get a written {notice} to end their tenancy?
      % endif
    field: got_notice_to_terminate
    datatype: yesnomaybe
  - label: |
      % if person_answering == "tenant":
      About what day did you **get** the notice?
      % else:
      About what day did the tenant **get** the notice?
      % endif
    field: received_notice_date
    datatype: date
    show if: got_notice_to_terminate
    max: ${ today().format("yyyy-MM-dd") }
  - label: |
      % if person_answering == "tenant":
      Did the notice include a specific day to **end** your tenancy?
      % else:
      Did the notice include a specific day to **end** the tenant's tenancy?
      % endif
    field: notice_to_terminate_includes_specific_day
    input type: radio
    choices:
      - Yes, it had a specific day: specific_day
      - It said to move at the end of the next rental period: rental_period
      - It did not say when to move: no_specific_day
      - It said something else: something_else
    show if: got_notice_to_terminate
  - label: |
      % if person_answering == "tenant":
      What day did the notice say it would end your tenancy?
      % else:
      What day did the notice say it would end the tenant's tenancy?
      % endif
    field: termination_of_tenancy_date
    datatype: date
    max: ${ today().format("yyyy-MM-dd") }
    show if:
      variable: notice_to_terminate_includes_specific_day
      is: specific_day
---
id: lease requirement for notice
question: |
  % if person_answering == "tenant":
  Notice requirements in your lease
  % else:
  Notice requirements in the tenant's lease
  % endif
subquestion: |
  % if person_answering == "tenant": 
  Look at the lease to answer this question. If you do not have
  the lease in front of you, do your best to answer from memory.
  %endif

  Most leases will include a specific amount of notice that the landlord
  must give the tenant before filing an eviction case. For example:
  it may say that you must act to fix any problem they notify you about
  within 7, 10, or 30 days. In the lease, look for a section labeled
  "Termination," "Notice" or "Default."
fields:
  - Does the lease say how much {notice} the landlord must give to the tenant?: lease_says_how_much_notice
    datatype: yesnomaybe
  - label: |
      **Summarize the notice amount from the lease.**
      
      For example:

      you can write "30 days" or "the end of next rental period,"
      depending on what the lease says.
    label above field: True
    field: notice_required_by_lease
    datatype: area
    rows: 2
    show if: lease_says_how_much_notice
  - label: |
      % if person_answering == "tenant":
      **Did the landlord give you the amount of notice required by the lease?**

      % if notice_to_terminate_includes_specific_day == "specific_day":
      Earlier, you said you got ${ (termination_of_tenancy_date - received_notice_date).days } days notice.
      % endif
      % else:
      **Did the landlord give the tenant the amount of notice required by the lease?**

      % if notice_to_terminate_includes_specific_day == "specific_day":
      Earlier, you said the tenant got ${ (termination_of_tenancy_date - received_notice_date).days } days notice.
      % endif
      % endif
      % if person_answering == "tenant":
      Answer as well as you can.
      % else:
      The tenant should answer as well as they can.
      % endif
    field: landlord_gave_notice_required_by_lease
    datatype: yesnomaybe
    show if: lease_says_how_much_notice
---
depends on:
  - got_notice_to_terminate
code: |
  if case_type["AC Unlawful Detainer"]:
    defense_ud_no_written_notice = not got_notice_to_terminate
  else:
    defense_ud_no_written_notice = None
---
depends on:
  - is_mobile_home_owner
  - rent_day
  - rent_period
  - received_notice_date
  - notice_to_terminate_includes_specific_day
  - termination_of_tenancy_date
code: |
  if case_type["AC Unlawful Detainer"]:
    defense_ud_no_rental_period_notice = got_notice_to_terminate and has_improper_notice(
      showifdef("is_mobile_home_owner"),
      int(showifdef("rent_day", 1)),
      int(showifdef("rent_period",12)),
      received_notice_date,
      showifdef("notice_to_terminate_includes_specific_day"),
      showifdef("termination_of_tenancy_date")
    )
  else:
    defense_ud_no_rental_period_notice = None
---
depends on:
  - kind_of_lease_agreement
code: |
  if kind_of_lease_agreement == "no_written_lease":
    has_written_lease = False
  else:
    has_written_lease = True
---
id: lease attached to petition
question: |
  Is a copy of the lease attached to the petition?
fields:
  - "Is the lease attached to the Landlord's Petition?": lease_attached
    datatype: yesnoradio
---
id: petition requirements - terms of lease
question: |
  % if person_answering == "tenant":
  Does the petition say what the terms of your rental agreement are?
  % else:
  Does the petition say what the terms of the tenant's rental agreement are?
  % endif
subquestion: |
  % if person_answering == "tenant":
  With the Landlord's Petition, your landlord must have either:
  
   1. attached a copy of the lease, or
   2. written a summary of your rental agreement, including the monthly rent, the kind of agreement (year to year or {month-to-month lease|month to month}), and the day rent is due.
  % else: 
    With the Landlord's Petition, the tenant's landlord needs to either:
  
   1. attach a copy of the lease, or
   2. write a summary of the tenant's rental agreement, including the monthly rent, the kind of agreement (year to year or {month-to-month lease|month to month}), and the day rent is due.
  % endif
  
  You said that a copy of the lease is not attached to the petition.
  
  A rental summary in the petition may look like this:

  [FILE ComplaintTerms.png, 100%]
fields:
  - note: |
      <h2 class="h4">Summary of rental agreement</h2>
      The Petition should include a summary of the rental agreement. It should include 
      at least:

      * The rent amount,
      * The day rent is due, and
      * The kind of agreement (year to year or {month-to-month lease|month to month}).
    js show if: |
      val("has_written_lease") === false || val("lease_attached") === false    
  - label: |
      % if person_answering == "tenant":
      Does the {petition|Landlord's Petition} include a summary of your rental agreement?
      % else:
      Does the {petition|Landlord's Petition} include a summary of the tenant's rental agreement?
      % endif 
    field: petition_states_terms_of_lease
    datatype: yesnomaybe
    show if:
      code: |
        has_written_lease == False or lease_attached == False
---
id: petition requirements - periods due
question: |
  % if person_answering == "tenant":
  Does the petition say the amount you owe for each month?
  % else: 
  Does the petition say the amount the tenant owes for each month?
  % endif
subquestion: |
  % if person_answering == "tenant":
  The Landlord's Petition must say what months you allegedly owe rent for.
  % else: 
  The Landlord's Petition must say what months the tenant allegedly owes rent for.
  % endif
fields:
  - label: |
      % if person_answering == "tenant":
      Does the {petition} say a specific amount for each month your landlord says you owe rent?
      % else:
      Does the {petition} say a specific amount for each month the landlord says the tenant owes rent?
      % endif 
    field: petition_states_rent_periods
    datatype: yesnomaybe
---
if: |
  petition_states_rent_amount == False
code: |
  petition_states_rent_periods = False
---
id: petition requirements - demand
question: |
  Does the Petition say that the landlord demanded rent?
subquestion: |
  % if person_answering == "tenant":
  The Landlord's Petition must say that the "landlord demanded rent", meaning that the landlord told you that you had to pay rent or leave.
  % else:
  The Landlord's Petition must say that the "landlord demanded rent", meaning that the landlord told the tenant that they had to pay rent or leave.
  % endif
  
  The Demand may look like this, but can have different language:
  
  [FILE ComplaintDemand.png, 100%]
 
fields:
  - "Does the {petition|Landlord's Petition} say the landlord demanded rent?": petition_states_demand_made
    datatype: yesnomaybe
---
id: is seeking past due rent true
comment: |
  DOCKET
  (PETITION)
question: |
  Is the landlord seeking recovery of past-due rent?
help:
  label: |
    How do I find this?
  content: |
    This information can be found on the **Docket** or the **Petition**.
    
    (TODO: Insert information to help user locate this information on the Docket and Petition)
fields:
  - "": is_rent_sought
    datatype: yesno
    input type: yesnoradio
---
id: has refused payment
comment: |
  ADDITIONAL
  (TODO: support multiple refusal dates)
  (TODO: implement Other explanation)
  (TODO: change was_attempt_full question options from Yes/No to Full/Partial)
question: |
  % if person_answering == "tenant":
  Did you try to pay the rent?
  % else: 
  Did the tenant try to pay the rent?
  % endif
subquestion: |
  % if person_answering == "tenant" and petition_states_rent_amount:
  Your landlord said you owe ${ currency(rent_amount_owed) }. Think about this amount when you answer
  the questions on this page.
  % elif person_answering in ["attorney","tenant_helper"] and petition_states_rent_amount:
    The landlord said the tenant owes ${ currency(rent_amount_owed) }. The tenant should think about this amount when they answer
  the questions on this page.
  % endif
fields:
  - label: |
      % if person_answering == "tenant":
      Did you offer to give your landlord the money they say you owe?
      % else:
      Did the tenant offer to give the landlord the money they say the tenant owes?
      % endif 
    field: offer_attempts.there_are_any
    datatype: yesnoradio
---
id: payment attempt loop
question: |
  % if person_answering == "tenant":
  Information about the ${ ordinal(i) } time you tried to pay the rent
  % else: 
  Information about the ${ ordinal(i) } time the tenant tried to pay the rent
  % endif
subquestion: |
  % if i > 0:
  % if person_answering == "tenant":
  So far, you said you
  % else: 
  So far, the tenant said they
  % endif
  % for offer in offer_attempts.complete_elements():
  
   - Tried to pay ${ "the full amount" if offer.was_attempt_full else "part of the rent" } on ${ offer.attempt_date } ${ offer.attempt_method if not offer.attempt_method == "other" else "" }.
   
  % endfor
  % endif
fields:
  - When?: offer_attempts[i].attempt_date
  - label: |
      % if person_answering == "tenant":
      How did you try to give your landlord the money?
      % else:
      How did the tenant try to give the landlord the money?
      % endif 
    field: offer_attempts[i].attempt_method
    input type: radio
    choices:
      - ${"I wrote a letter" if person_answering == "tenant" else "Wrote a letter"}: "by letter"
      - ${"I sent an email" if person_answering == "tenant" else "Sent an email"}: "by email"
      - ${"I told my landlord in person" if person_answering == "tenant" else "Told the landlord in person"}: "in person"
      - ${"I told my landlord in a phone call" if person_answering == "tenant" else "Told the landlord in a phone call"}: "in a phone_call"
      - Other: "other"
  - Explanation: offer_attempts[i].attempt_method_other
    datatype: area
    show if:
      variable: offer_attempts[i].attempt_method
      is: other
  - label: |
      % if person_answering == "tenant":
      How much did you offer to pay?
      % else:
      How much did the tenant offer to pay?
      % endif 
    field: offer_attempts[i].was_attempt_full
    datatype: radio
    choices:
      - All of the money: True
      - Part of the money: False
  - label: |
      % if person_answering == "tenant":
      Did your landlord say no to your offer to pay?
      % else:
      Did the landlord say no to the tenant's offer to pay?
      % endif 
    field: offer_attempts[i].has_refused_payment
    datatype: yesnoradio
  - label: |
      % if person_answering == "tenant":
      Did your landlord say no in a writing that you can bring to court? Did someone else see your landlord say "no"?
      % else:
      Did the landlord say no in a writing that the tenant can bring to court? Did someone else see the tenant's landlord say "no"?
      % endif 
    field: offer_attempts[i].has_attempt_evidence
    datatype: yesnoradio
#  - note: |
#      ${ collapse_template(example_of_refused_payment_evidence) }
#    show if: offer_attempts[i].has_refused_payment
---
#template: example_of_refused_payment_evidence
#subject: |
#  What kind of evidence?
#content: |
#  For example, a letter from the landlord refusing to accept the money, a written check or money order, or a witness to the landlord's refusal.
---
id: payment attempt loop 2
question: |
  % if person_answering == "tenant":
  Did you make any other attempts to pay the rent?
  % else: 
  Did the tenant make any other attempts to pay the rent?
  % endif
subquestion: |
  % if len(offer_attempts.complete_elements()) > 0:
  % if person_answering == "tenant":
  So far, you said you
  % else: 
  So far, the tenant said they
  % endif
  % for offer in offer_attempts.complete_elements():
  
   - tried to pay ${ "the full amount" if offer.was_attempt_full else "part of the rent" } on ${ offer.attempt_date } ${ offer.attempt_method if not offer.attempt_method == "other" else "" }.
   
  % endfor
  % endif
fields:
  - label: |
      % if person_answering == "tenant":
      Did you make any other attempts to pay the rent?
      % else:
      Did the tenant make any other attempts to pay the rent?
      % endif 
    field: offer_attempts.there_is_another
    datatype: yesnoradio
---
id: pay and stop eviction
decoration: circle-info
question: |
  % if person_answering == "tenant":
  You may be able to {PAY AND STAY|pay and stop the eviction}
  % else:
  The tenant may be able to {PAY AND STAY|pay and stop the eviction}
  % endif
subquestion: |
  % if person_answering == "tenant":
  If you:
  % if petition_states_rent_amount:
  
  * Pay the full ${ currency(rent_amount_owed) }, and 
  % else:
  
  * Pay the full amount you owe, and 
  % endif
  * Pay the full court costs

  You can stop the eviction and stay in your home.
  % else: 
  If the tenant:
  % if petition_states_rent_amount:
  
  * Pays the full ${ currency(rent_amount_owed) }, and 
  % else:
  
  * Pays the full amount they owe, and 
  % endif
  * Pays the full court costs

  The tenant can stop the eviction and stay in their home.
  % endif
fields:
  - label: |
      % if person_answering == "tenant":
      Will you pay the full amount your landlord says you owe, plus {court costs}, to stop the {eviction}?
      % else:
      Will the tenant pay the full amount their landlord says the tenant owes them, plus {court costs}, to stop their {eviction}?
      % endif 
    field: will_offer_payment
    datatype: yesnoradio
---
id: warranty of habitability
question: |
  % if person_answering == "tenant":
  Does your home have any of the problems listed below?
  % else: 
  Does the tenant's home have any of the problems listed below?
  % endif
subquestion: |
  ${ collapse_template(bad_conditions_explanation_template) }

  You can also list problems that have been fixed if they happened within the last 2 years. 
fields: 
  - label: |
      % if person_answering == "tenant":
      Have you had any of these problems **in the last 2 years**?
      % else:
      Has the tenant had any of these problems **in the last 2 years**?
      % endif 
    field: warranty_breaches
    datatype: checkboxes
    choices: 
      - ${ conditions_text["no_heat"] }: no_heat
      - ${ conditions_text["no_cooling"] }: no_cooling
      - ${ conditions_text["insufficient_water"] }: insufficient_water
      - ${ conditions_text["insecure_locks"] }: insecure_locks
      - ${ conditions_text["mice_or_rats"] }: mice_or_rats
      - ${ conditions_text["roaches"] }: roaches
      - ${ conditions_text["bedbugs"] }: bedbugs
      - ${ conditions_text["chronic_dampness"] }: chronic_dampness
      - ${ conditions_text["standing_water"] }: standing_water
      - ${ conditions_text["electric_problem"] }: electric_problem
      - ${ conditions_text["lead_paint"] }: lead_paint
      - ${ conditions_text["leaky_windows"] }: leaky_windows
      - ${ conditions_text["has_plumbing_problems"] }: has_plumbing_problems
      - ${ conditions_text["has_structural_issues"] }: has_structural_issues
      - ${ conditions_text["ceiling_not_weathertight"] }: ceiling_not_weathertight
      - ${ conditions_text["floor_holes"] }: floor_holes
      - ${ conditions_text["trash"] }: trash
      - ${ conditions_text["fire_safety"] }: fire_safety
      - Other: other
  - label: |
      % if person_answering == "tenant":
      What other problems do you have?
      % else:
      What other problems does the tenant have?
      % endif 
    field: warranty_breach_other
    datatype: area
    show if: warranty_breaches['other']
---
id: estoppel breaches
question: |
  % if person_answering == "tenant":
  Did your landlord violate other laws?
  % else: 
  Did the landlord violate other laws?
  % endif
subquestion: |
  Answer this question if there are other violations that you know about. The previous questions asked about the most important violations, but this question is intended to allow you to add any other legal violations that you know about.
  
  For example, some cities and towns require a landlord have an occupancy permit to rent a home. The occupancy permit is a document that says the home is safe to live in.
  
  It is OK to answer "None of the above".
fields:
  - label: |
      % if person_answering == "tenant":
      What law did your landlord violate?
      % else:
      What law did the tenant's landlord violate?
      % endif
    field: estoppel_breaches
    datatype: checkboxes
    choices:
      - ${ estoppel_breaches_text['occupancy_permit'] }: occupancy_permit
      - Other law: other
  - label: |
      Explain
    field: other_estoppel_breaches
    show if: estoppel_breaches['other']
    datatype: area
    rows: 2
---
variable name: estoppel_breaches_text
use objects: True
data:
  not_up_to_code:
    question: The home is not up to code.
    document: The home is not up to code.
  violated_law:
    question: The landlord violated local or state laws about the condition of the home.
    document: The landlord violated local or state laws about the condition of the home.
  occupancy_permit:
    document: The landlord does not have an occupancy permit for the home.
    question: The landlord does not have an occupancy permit for the home.
---
template: estoppel_explanation_template
subject: |
  What other laws does a landlord have to follow?
content: |
  Some cities and towns require a landlord have an occupancy permit to rent a home.
  The occupancy permit is a document that says the home is safe to live in.

  If you are not sure, it is OK to leave this question blank.
---
variable name: conditions_text
use objects: True
data:
  no_heat:
    question: No heat or not enough heat in the winter time
    document: No heat or not enough heat in the winter time
  no_cooling:
    question: Too hot in the summer
    document: Too hot in the summer
  insufficient_water:
    question: Not enough hot or cold water
    document: Not enough hot or cold water
  insecure_locks:
    question: Locks are missing or not secure on windows or doors
    document: Locks are missing or not secure on windows or doors
  mice_or_rats:
    question: Mice or rats
    document: Mice or rats
  roaches:
    question: Cockroaches
    document: Cockroaches
  bedbugs:
    question: Bedbugs
    document: Bedbugs
  chronic_dampness:
    question: Mold, damp walls, ceilings or walls
    document: Mold, damp walls, ceilings or walls
  standing_water:
    question: Standing water or sewage
    document: Standing water or sewage
  electric_problem:
    question: Problem with electric wiring, outlets or switches
    document: Problem with electric wiring, outlets or switches
  lead_paint:
    question: Lead paint on a surface reachable by a young child
    document: Lead paint on a surface reachable by a young child
  leaky_windows:
    question: Windows are leaky
    document: Windows are leaky
  has_plumbing_problems:
    question: Has plumbing not in working order or is subject to flooding
    document: Has plumbing not in working order or is subject to flooding
  has_structural_issues:
    question: Dangerous structural problem, like unsafe stairs or railways
    document: Dangerous structural problem
  ceiling_not_weathertight:
    question: Ceiling has holes or cracks or is not weathertight
    document: Ceiling has holes or cracks or is not weathertight
  floor_holes:
    question: Floor has holes or cracks
    document: Floor has holes or cracks
  trash:
    question: Inadequate trash collection
    document: Inadequate trash collection
  fire_safety:
    question: Broken smoke detectors
    document: Broken smoke detectors
---
## leaving "you" references because not sure how to make conditional
variable name: cqe_breaches_text
use objects: True
data:
  harassment:
    question: |
      % if person_answering == "tenant":
      Harass you in person or on the phone
      % else:
      Harassed Tenant in person or on the phone
      % endif
    document: Harassed Tenant in person or on the phone
  visits:
    question: |
      % if person_answering == "tenant":
      Make frequent or unnecessary visits or inspections of the property
      % else:
      Made frequent or unnecessary visits or inspections of the property
      % endif
    document: Made frequent or unnecessary visits or inspections of the property
  remodeling:
    question: |
      % if person_answering == "tenant":
      Do unnecessary remodeling work, or maintenance work that takes longer than they promised
      % else:
      Performed unnecessary remodeling work, or maintenance work that took longer than they promised
      % endif
    document: Performed unnecessary remodeling work, or maintenance work that took longer than they promised
  access:
    question: |
      % if person_answering == "tenant":
      Allow construction that stops you from easily getting into your home or makes you take a long detour
      % else:
      Allows construction that stops the tenant from easily getting into their home or makes them take a long detour
      % endif
    document: Allows construction that stops the tenant from easily getting into their home or makes them take a long detour
  animal:
    question: |
      % if person_answering == "tenant":
      Allow their own dog or pet to bark constantly and disturb you
      % else:
      Allowed their dog or pet to bark constantly and disturb Tenant
      % endif 
    document: Allowed their dog or pet to bark constantly and disturb Tenant
  vermin:
    question: |
      % if person_answering == "tenant":
      Not exterminate or take care of vermin or pests in the walls making disruptive noises
      % else:
      Failed to exterminate or take care of vermin or pests in the walls making disruptive noises
      % endif
    document: Failed to exterminate or take care of vermin or pests in the walls making disruptive noises
---
template: bad_conditions_explanation_template
subject: |
  % if person_answering == "tenant":
  Why does the condition of my house matter?
  % else: 
  Why does the condition of the tenant's house matter?
  % endif
content: |
  % if person_answering == "tenant":
  Your landlord may owe you money if there are problems in your home. The money your landlord owes you might
  mean you do not owe part or all of the rent your landlord says you owe.
  
  Problems in your home may give you a claim for **Breach of {Implied Warranty of Habitability}** 
  if the condition of your home affected your life, health, or safety, and made the dwelling {uninhabitable living condition|uninhabitable} in whole or in part.
  % else: 
  The landlord may owe the tenant money if there are problems in their home. The money the landlord owes the tenant might
  mean they do not owe part or all of the rent the landlord says the tenant owes.
  
  Problems in the tenant's home may give them a claim for **Breach of {Implied Warranty of Habitability}** 
  if the condition of their home affected their life, health, or safety, and made the dwelling {uninhabitable living condition|uninhabitable} in whole or in part.  
  % endif
---
id: covenant of quiet enjoyment
question: |
  % if person_answering == "tenant":
  Did your landlord violate your right to live peacefully in your home?
  % else:
  Did the landlord violate the tenant's right to live peacefully in their home?
  % endif
subquestion: |
  ${ collapse_template(bqe_explanation_template) }
fields: 
  - label: |
      % if person_answering == "tenant":
      Did your landlord:
      % else:
      The landlord:
      % endif 
    field: cqe_breaches
    datatype: checkboxes
    choices:
      - ${ cqe_breaches_text["harassment"] }: harassment
      - ${ cqe_breaches_text["visits"] }: visits
      - ${ cqe_breaches_text["remodeling"] }: remodeling
      - ${ cqe_breaches_text["access"] }: access
      - ${ cqe_breaches_text["animal"] }: animal
      - ${ cqe_breaches_text["vermin"] }: vermin
      - ${ "Otherwise violate your right to live peacefully in your home" if person_answering == "tenant" else "Otherwise violated the tenant's right to live peacefully in their home"}: other
  - Other (explain): other_cqe_breach
    datatype: area
    show if: cqe_breaches["other"]
---
template: bqe_explanation_template
subject: |
  Why does this matter?
content: |
  % if person_answering == "tenant":
  Your landlord may owe you money if they violated your right to live peacefully in your home. The money may
  reduce the amount of rent you owe or mean that you do not owe any rent to your landlord.

  You have a claim of **Breach of Covenant of Quiet Enjoyment** if your landlord is responsible for a substantial
  disruption in the use and {quiet enjoyment} of your rental property.
  % else: 
  The landlord may owe the tenant money if they violated the tenant's right to live peacefully in their home. The money may
  reduce the amount of rent the tenant owes or mean that the tenant does not owe any rent to the landlord.

  The tenant has a claim of **Breach of Covenant of Quiet Enjoyment** if the landlord is responsible for a substantial
  disruption in the use and {quiet enjoyment} of the rental property.
  % endif
---
id: Rent paid
question: |
  % if person_answering == "tenant":
  Have you paid at least part of the rent your landlord says you owe?
  % else: 
  Has the tenant paid at least part of the rent the landlord says the tenant owes?
  % endif
subquestion: |
  % if person_answering == "tenant" and petition_states_rent_amount:
  You said your landlord said you owe ${ currency(rent_amount_owed) }.
  % elif petition_states_rent_amount:
  The tenant's landlord said the tenant owes ${ currency(rent_amount_owed) }.
  % endif
fields:
  - label: |
      % if person_answering == "tenant":
      I paid at least part of the rent
      % else:
      The tenant paid at least part of the rent
      % endif
    field: was_rent_paid
    datatype: yesnoradio
  - label: |
      % if person_answering == "tenant":
      How much did you pay?
      % else:
      How much did the tenant pay?
      % endif
    field: rent_amount_paid
    datatype: radio
    choices: 
      - ${ rent_amount_paid_text["all"] }: all
      - ${ rent_amount_paid_text["a_portion"] }: a_portion
    show if: was_rent_paid
---
variable name: rent_amount_paid_text
use objects: True
data:
  all:
    question: |
      % if person_answering == "tenant":
      I paid all of the rent
      % else:
      The tenant paid all of the rent
      % endif    
    document: |
      all
  a_portion:
    question: |
      % if person_answering == "tenant":
      I paid part of the rent
      % else:
      The tenant paid part of the rent
      % endif    
    document: |
      part
---
